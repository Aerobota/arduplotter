<%
  active = 'view'
  title = 'View Log'
%>
<div class="container">
	<div class="row">
		<div class="col-md-12">
			<p></p>
		</div>
	</div>
      
	<div class="row">
		<div class="col-md-12">
			<div id="mapContent">
				<div id="mapLoading">
					<p class="alert alert-info col-md-6 col-md-offset-3" id="mapLoadingMsg">Map Loading</p>
					<p class="alert alert-warning col-md-6 col-md-offset-3 hide" id="mapNoGpsError">No GPS data associated with this log</p>
				</div>

				<div class="btn-group" style="margin-bottom: 5px;">
					<div class="btn-group">
	    			<button type="button" class="btn btn-default" disabled>Map Options:</button>
	  			</div>
	  			<div class="btn-group">
	    			<button type="button" class="btn btn-default" onclick="app.play(0)" disabled><span class="glyphicon glyphicon-play"></span> Play Track</button>
	  			</div>
					<div class="btn-group">
					  <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" disabled>
					    Layers <span class="caret"></span>
					  </button>
					  <ul class="dropdown-menu" role="menu">
					    <li><a href="#">GPS Track</a></li>
					    <li><a href="#">Waypoints</a></li>
					  </ul>
					</div>
				</div>


				<div id="map-canvas"></div>
			</div>
		</div>
	</div>
      
	<div class="row">
		<div class="col-md-12">
			<div id="tabbed-content">

				<div id="loading" data-id="<%= log.logId %>">
					<div class="progress">
					  <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
					    <span class="sr-only"></span>
					  </div>
					</div>
				</div>


				<div class="btn-group pull-right ">
					<a href="/view/<%= log.logId %>.kml" class="btn btn-default"><span class="glyphicon glyphicon-download-alt"></span> KML</a>
					<a href="/view/<%= log.logId %>.log" class="btn btn-default"><span class="glyphicon glyphicon-download-alt"></span> Log</a>
				</div>

				<ul class="nav nav-tabs">
					<% if (log.logContains.curr) { %><li><a href="#power" data-toggle="tab">Power</a></li><% } %>
					<% if (log.logContains.ctun) { %><li><a href="#altitude" data-toggle="tab">Altitude</a></li><% } %>
					<% if (log.logContains.att) { %><li><a href="#attitude" data-toggle="tab">Attitude</a></li><% } %>
					<% if (log.logContains.gps) { %><li><a href="#gps" data-toggle="tab">GPS</a></li><% } %>
					<% if (log.logContains.imu) { %><li><a href="#imu" data-toggle="tab">IMU</a></li><% } %>
					<% if (log.logContains.ntun) { %><li><a href="#ntun" data-toggle="tab">NTUN</a></li><% } %>
					<li class="active"><a href="#messages" data-toggle="tab">Messages</a></li>
					<li><a href="#params" data-toggle="tab">Params</a></li>
				</ul>
				<p></p>


				<div class="tab-content">
	         
	        <% if (log.logContains.curr) { %>
					<div class="tab-pane" id="power">
						<div class="row">
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Total Current</h3>
									</div>
									<div class="panel-body">
										<div id="totcurrent-graph"  style="width:100%;height:300px;"></div>
										<p><strong>Total Current Used</strong> <span id="totCurrent"></span> mA</p>
									</div>
								</div>
							</div>
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Current over time</h3>
									</div>
									<div class="panel-body">
										<div id="current-graph"  style="width:100%;height:300px;"></div>
										<p><strong>Average Current</strong> <span id="avgCurrent"></span> A</p>
									</div>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size visible-md visible-lg"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Voltage over time</h3>
									</div>
									<div class="panel-body"><div id="voltage-graph"  style="width:100%;height:300px;"></div></div>
								</div>
							</div>
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<h3 class="panel-title">Flight Duration Calculator</h3>
									</div>
									<div class="panel-body">
										<form role="form" class="form-horizontal">
	  									<div class="form-group">
										    <label for="batteryCapacityInput" class="col-sm-4 control-label">Battery Capacity</label>
								        <div class="col-sm-8">
										    	<input type="number" class="form-control flight-duration-cal" id="batteryCapacityInput" value="" disabled>
									    	</div>
										  </div>
										  <div class="form-group">
										    <label for="currentDrawInput" class="col-sm-4 control-label">Average Current Draw</label>
								        <div class="col-sm-8">
										    	<input type="number" class="form-control flight-duration-cal" id="currentDrawInput" value="" disabled>
									    	</div>
										  </div>
										  <div class="form-group">
										    <label for="estFlightDurationInput" class="col-sm-4 control-label">Estimated Flight Duration</label>
										    <div class="col-sm-8">
													<div class="input-group">
											    	<input type="number" class="form-control" id="estFlightDurationInput" value="" disabled>
														<span class="input-group-addon">mins</span>
													</div>
												</div>
											</div>
											<div class="form-group">
										    <label for="flightDuration" class="col-sm-4 control-label">Actual Flight Duration</label>
										    <div class="col-sm-8">
													<div class="input-group">
											    	<input type="number" class="form-control" id="flightDuration" value="" disabled>
														<span class="input-group-addon">mins</span>
													</div>
												</div>
											</div>
										</form>
										<div class="callout callout-info">
											<h4>About this calculator</h4>
											<p>This is a quick and dirty calculation using the Battery Capacity parameter, and the calculated average current draw as measured by your APM.</p>
											<p>Please don't rely on this calculation for future flights! I just found it interesting to compare theortical flight times with actual.</p>
											<p><strong>Also note this calculator incorporates the &quot;80%&quot; rule.</strong></p>
										</div>
									</div>
								</div>
							</div>


						</div>
					</div><!-- /power tab -->
					<% } %>
		          
					<% if (log.logContains.curr) { %>
		      <div class="tab-pane" id="altitude">
						<div class="row">
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Altitude</h3>
									</div>
									<div class="panel-body"><div id="altitude-graph"  style="width:100%;height:300px;"></div></div>
								</div>
							</div>

							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Throttle</h3>
									</div>
									<div class="panel-body"><div id="throttle-graph"  style="width:100%;height:300px;"></div></div>
								</div>
							</div>

						</div>
						<div class="row">
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Climb Rate</h3>
									</div>
									<div class="panel-body"><div id="crate-graph"  style="width:100%;height:300px;"></div></div>
								</div>
							</div>
						</div>
					</div><!-- /altitude tab -->
		      <% } %>      

					<% if (log.logContains.att) { %>
		      <div class="tab-pane" id="attitude">
						<div class="row">
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Roll</h3>
									</div>
									<div class="panel-body"><div id="attitude-roll-graph"  style="width:100%;height:300px;"></div></div>
								</div>
							</div>
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Pitch</h3>
									</div>
									<div class="panel-body"><div id="attitude-pitch-graph"  style="width:100%;height:300px;"></div></div>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Yaw</h3>
									</div>
									<div class="panel-body"><div id="attitude-yaw-graph"  style="width:100%;height:300px;"></div></div>
								</div>
							</div>
						</div>
		      </div><!-- /attitude tab -->
		      <% } %>

					<% if (log.logContains.gps) { %>
		      <div class="tab-pane" id="gps">
						<div class="row">
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Status &amp; HDop</h3>
									</div>
									<div class="panel-body"><div id="gps-status-graph"  style="width:100%;height:300px;"></div></div>
								</div>
							</div>
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Satellites</h3>
									</div>
									<div class="panel-body"><div id="gps-satellites-graph"  style="width:100%;height:300px;"></div></div>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Speed</h3>
									</div>
									<div class="panel-body">
										<div id="gps-speed-graph"  style="width:100%;height:300px;"></div>
										<p><strong>Average Speed:</strong> <span id="avgSpeed"></span>m/s</p>
									</div>
								</div>
							</div>
						</div>
		      </div><!-- /gps tab -->
		      <% } %>

					<% if (log.logContains.imu) { %>
		      <div class="tab-pane" id="imu">
						<div class="row">
							<div class="col-md-6">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">Vibrations</h3>
									</div>
									<div class="panel-body"><div id="vibrations-graph"  style="width:100%;height:300px;"></div></div>
								</div>
							</div>
							<div class="col-md-6">
								<div class="callout callout-info">
									<h4>Vibrations Graph Information</h4>
									Horizontal lines mark the acceptable vibrations for ArduPilot. If you have a lot of measurements over these ranges you may want to look at various vibration dampening methods. More infomation can be found on the <a href="http://copter.ardupilot.com/wiki/common-diagnosing-problems-using-logs/#Vibrations" target="_blank">ardupilot website.</a>
								</div>
							</div>
						</div>
					</div>
					<% } %>

					<% if (log.logContains.ntun) { %>
		      <div class="tab-pane" id="ntun">
						<div class="row">
							<div class="col-md-12">
								<div class="panel panel-primary">
									<div class="panel-heading">
										<button class="btn btn-xs btn-primary pull-right toggle-size"><span class="glyphicon glyphicon-resize-full"></button>
										<h3 class="panel-title">NTUN Data</h3>
									</div>
									<div class="panel-body">
										<div id="ntun-velocity-graph"  style="width:100%;height:500px;"></div>
										<p>Click <a href="http://copter.ardupilot.com/wiki/loiter-mode/#Verifying_Loiter_performance_with_dataflash_logs" target="_blank">here</a> for more information about this graph</p>
									</div>
								</div>
							</div>
						</div>
					</div>
					<% } %>

					<div class="tab-pane active" id="messages">
						<div class="row">
							<div class="col-md-12" id="logMessagesContent">
							<% /*
								<table class="table" id="errors">
									<tr>
										<th class="text-center active">Brownout</th>
										<th class="text-center success">Compass</th>
										<th class="text-center warning">GPS</th>
										<th class="text-center danger">Dupe Log Data</th>
										<th class="text-center">Event/Failsafe</th>
										<th class="text-center">Parameters</th>
										<th class="text-center">Empty</th>
										<th class="text-center">VCC</th>
									</tr>
									<tr>
										<td class="text-center active">PASS</td>
										<td class="text-center success">PASS</td>
										<td class="text-center warning">PASS</td>
										<td class="text-center danger">PASS</td>
										<td class="text-center info">PASS</td>
										<td class="text-center">PASS</td>
										<td class="text-center">PASS</td>
										<td class="text-center">PASS</td>
									</tr>
								</table>
*/ %>
			      	
	          	</div>
	          </div>
	          <div class="row">
	          	<div class="col-md-12 hide" id="logWarnings">
	          		<h3>ArduPlotter Warnings</h3>
	          		<p>Below are any problems ArduPlotter had whilst processing your log</p>
	          		<div id="logWarningsContent">
	          			No Problems
	          		</div>
	          	</div>
          	</div>
		      </div>


		      <div class="tab-pane" id="params">

			      <div class="col-md-6 col-md-offset-3">
			        <table class="table table-hover table-striped" id="paramsTable">
			        	<thead>
				          <tr>
				            <th>Parameter</th>
				            <th>Value</th>
				          </tr>
			          </thead>
			          <tbody>
			          </tbody>
	 						</table>
			      </div>
			    </div>
		    </div>
	    </div>
		</div>
	</div>
</div>
<%
scripts = '<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>' +
'<script language="javascript" type="text/javascript" src="/flot/jquery.flot.js"></script>' + 
'<script language="javascript" type="text/javascript" src="/flot/jquery.flot.resize.min.js"></script>' + 
'<script language="javascript" type="text/javascript" src="/flot/jquery.flot.navigate.js"></script>' +
'<script language="javascript" type="text/javascript" src="/flot/jquery.flot.crosshair.js"></script>' + 
'<script language="javascript" type="text/javascript" src="/js/app.js?v=4"></script>';
//'<script language="javascript" type="text/javascript" src="/view/' + log.id + '.js"></script>';
%>
